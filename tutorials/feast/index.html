<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8"/>
	<title>feast/</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<!-- RSS feed -->
	<link rel="alternate" type="application/rss+xml" title="Bedford Lab Research" href="http://laduplessis.github.io//feed.xml">
	
    <!-- Customized Bootstrap + Font Awesome + Solarized -->
    <link href="/blotter/css/style.css" rel="stylesheet" media="screen">

	<!-- Favicon -->
	<link rel="shortcut icon" href="/blotter/images/favicon.png"/>	

	<!-- Typekit -->
	<script>
	  (function(d) {
		var config = {
		  kitId: 'xeu8jut',
		  scriptTimeout: 3000
		},
		h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='//use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
	  })(document);
	</script>
		
	<!-- Google Analytics -->	
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-26244371-2', 'laduplessis.github.io/Taming_the_BEAST_blotter');
		ga('send', 'pageview');

	</script>
	
	<!-- jQuery -->
	<script src="/blotter/js/jquery.min.js"></script>
	
	<!-- Bootstrap -->
	<script src="/blotter/js/transition.js"></script>
	<script src="/blotter/js/collapse.js"></script>

</head>

<body>
	
	<div id="header">
	<nav class="navbar navbar-default navbar-static-top" role="navigation">	 
		<div class="container">	

			<div class="navbar-header">
				<!--button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-element" aria-expanded="false">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button-->
									
				<a class="navbar-brand" href="/blotter/">Taming the BEAST</a>
				<object class="logo navbar-brand" data="/blotter/images/logo_bw.svg" type="image/svg+xml"></object>
				
			</div>

			<div class="collapse navbar-collapse" id="navbar-collapse-element">
				<ul class="nav navbar-nav navbar-right">					
					
					<li>
					
					<a href="/blotter/news/">news</a>
					</li>
					
					<li>
					
					<a href="/blotter/tutorials/">tutorials</a></li>	    	  
					
					<li>
					
					<a href="/blotter/about/">about</a></li>	    	  
				</ul>
			</div>
			
		</div>
	</nav>	
</div>
	
	<div class="container">	
		
	

<div class="row">
	<div class="col-md-12">
		<div class="bigtitle titlebox">
			<ol class="breadcrumb">
			
			
				
				
				
				<li>feast</li>
				
			
			</ol>
		</div>
		<p>
		<div class="head">
			Bite-sized additions to BEAST 2
		</div>
	</div>				
</div>

<div class="bigspacer"></div>

<div class="row">
	<div class="col-md-3">
		<div class="bigspacer"></div>
		<div class="smallhead">
			PDF
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
			</ul>
		</div>		
		<div class="spacer"></div>
		<div class="smallhead">
			Source code
		</div>	
		<div class="pad-left note">
			<div class="smallspacer"></div>
			<i class="fa fa-cog fa-fw"></i>
			<a class="off" href="https://github.com/tgvaughan/feast">github.com/tgvaughan/feast</a>
		</div>
		<div class="bigspacer"></div>
		<div class="smallhead">
			Contributors
		</div>	
		<div class="pad-left note">
				
			<div class="smallspacer"></div>				
			<div>
				<a class="off" href="https://github.com/tgvaughan">
    			<img class="pull-left avatar" src="https://avatars.githubusercontent.com/u/512538?v=3&s=50">
    			<div class="handlebox" style="padding-left:5px;">
    				tgvaughan
    			</div>
 				</a>
 			</div>			
 			
		</div>
		<div class="bigspacer"></div>
		<div class="smallhead">
			Latest commits
		</div>		
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
			
				<div class="smallspacer"></div>
				<li> 
					<i class="fa fa-check-square-o fa-fw"></i>
					<a class="off" href="https://github.com/tgvaughan/feast/commit/fcf907bccf8ae2a932484b8684d617ec03158ed5">
					27 Jul 2016 - <span class="text-gray">Fixed build script bug.</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="fa fa-check-square-o fa-fw"></i>
					<a class="off" href="https://github.com/tgvaughan/feast/commit/43796df48454995cc9044dd3b37e115a86edf90c">
					27 Jul 2016 - <span class="text-gray">Updated readme.</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="fa fa-check-square-o fa-fw"></i>
					<a class="off" href="https://github.com/tgvaughan/feast/commit/7d6f586fd9c9f58cc8a75f43d999fbb9d292a7a7">
					27 Jul 2016 - <span class="text-gray">Updated build script.</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="fa fa-check-square-o fa-fw"></i>
					<a class="off" href="https://github.com/tgvaughan/feast/commit/f03c2f5ac47ad89b41c963ed1c4fecc8607ee0f7">
					12 Jul 2016 - <span class="text-gray">Updated build script.</span>
					</a> 
				</li>
			
				<div class="smallspacer"></div>
				<li> 
					<i class="fa fa-check-square-o fa-fw"></i>
					<a class="off" href="https://github.com/tgvaughan/feast/commit/9dd95f5e307276ed905c95bfa495a91ed78069ab">
					12 Jul 2016 - <span class="text-gray">Updated expression notation.</span>
					</a> 
				</li>
			
			</ul>
		</div>		
		<div class="spacer"></div>	
		
					
			
					
			
					
			
					
			
					
			
					
			
					
			
					
			
					
			
					
			
			<!-- 1 -->
			
					
			
					
			
					
			
		
				
		
		<div class="smallhead">
			Pages
		</div>				
		<div class="pad-left smallnote">
			<ul class="list-unstyled">
						
				
						
				
						
				
						
				
						
				
						
				
						
				
						
				
						
				
						
				
				<div class="smallspacer"></div>
				<li> 
					<a class="off" href="/tutorials/feast/">
					<i class="fa fa-folder-open-o"></i>  / 
					</a> 
				</li>					
				
						
				
						
				
						
				
			
			</ul>			
		</div>	
		<div class="spacer"></div>		
		
		
	</div>
	<div class="col-md-8">				
		<div class="post">
			<p>
			<h1>feast:  Bite-sized additions to BEAST 2</h1>

<p>This is a small <a href="http://www.beast2.org">BEAST 2</a> package which
contains some additions to the core functionality.</p>

<p><a href="https://travis-ci.org/tgvaughan/feast"><img src="https://travis-ci.org/tgvaughan/feast.svg?branch=master" alt="Build Status"></a></p>

<h2>Installation</h2>

<p>You can install directly from within BEAUti by adding
the following URL <code>http://tgvaughan.github.io/feast/package.xml</code> to
the list of package repositories and selecting feast from the package
list.</p>

<p>More recent releases are also made available as archives containing
only the necessary jar files and the associated javadocs. These are
for the use of BEAST 2 package developers who want to use some of the
classes but don&#39;t want to add a full package dependency.  These
archives have the form <code>*-jarsOnly.zip</code> and are also found at
<a href="https://github.com/tgvaughan/feast/releases">https://github.com/tgvaughan/feast/releases</a>.</p>

<h2>Building from source</h2>

<p>The default target in the provided <a href="http://ant.apache.org">Apache ANT</a>
build script can be used to build the BEAST 2 package from scratch.
The package will be left in the <code>dist/</code> directory.</p>

<h2>Function Slicing</h2>

<p>Instances of the <code>Slice</code> class are <code>Function</code>s and <code>Loggable</code>s which
represent or more elements of another <code>Function</code>.  This allows
element-specific priors to be set, and individual elements to be logged.</p>

<h2>DensityMapper</h2>

<p>This class provides an easy way to produce plots of the variation in a
particular <code>Distribution</code> (i.e. probability density) as a function of one or
more parameters.  The class extends the BEAST <code>Runnable</code> abstract class and
thus takes the place of the <code>MCMC</code> class in a regular BEAST XML.  To use
<code>DensityMapper</code> you&#39;ll therefore need to create an XML with the following
general form:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;beast</span> <span class="na">version=</span><span class="s">"2.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;run</span> <span class="na">spec=</span><span class="s">"DensityMapper"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;distribution</span> <span class="na">id=</span><span class="s">"distrib"</span> <span class="err">...</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;realParam</span> <span class="na">spec=</span><span class="s">"RealParameter"</span> <span class="na">id=</span><span class="s">"paramA"</span>
            <span class="na">value=</span><span class="s">"V_A"</span> <span class="na">lower=</span><span class="s">"LOWER_A"</span> <span class="na">upper=</span><span class="s">"UPPER_A"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;steps</span> <span class="na">spec=</span><span class="s">"IntegerParameter"</span>
            <span class="na">value=</span><span class="s">"STEPS_A"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;realParam</span> <span class="na">spec=</span><span class="s">"RealParameter"</span> <span class="na">id=</span><span class="s">"paramB"</span>
            <span class="na">value=</span><span class="s">"V_B1 V_B2"</span> <span class="na">lower=</span><span class="s">"LOWER_B"</span> <span class="na">upper=</span><span class="s">"UPPER_B"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;steps</span> <span class="na">spec=</span><span class="s">"IntegerParameter"</span>
            <span class="na">value=</span><span class="s">"STEPS_B1 STEPS_B2"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;logger</span> <span class="na">spec=</span><span class="s">"Logger"</span> <span class="na">logEvery=</span><span class="s">"1"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;log</span> <span class="na">idref=</span><span class="s">"paramA"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;log</span> <span class="na">idref=</span><span class="s">"paramB"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;log</span> <span class="na">idref=</span><span class="s">"distrib"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;logger&gt;</span>

        <span class="c">&lt;!-- Additional (screen?) loggers --&gt;</span>
    <span class="nt">&lt;/run&gt;</span>
<span class="nt">&lt;/beast&gt;</span>
</code></pre></div>
<p>The <code>&lt;realParam&gt;</code> elements specify which parameters are varied, the upper and
lower bounds of these parameters specify the range over which the parameter is
varied, and the corresponding <code>&lt;steps&gt;</code> elements specify the number of steps to
use for each parameter. When the number of steps is 1 the parameter is not
varied and instead the contents of the <code>value</code> attribute is used.</p>

<p>When parameters are vectors, the associated <code>&lt;steps&gt;</code> parameter may have
dimension 1 in which case all elements of the vector parameter are varied
together (e.g. [0,0], [0.1,0.1], ..., [1, 1]).  Alternatively, the steps
parameter may have dimension equal to that of the real parameter in which case
each element of the parameter is varied independently with the corresponding
number of steps (e.g. [0,0], [0, 0.1], ..., [0, 1], [0.1, 0.0], ..., [1, 1]).
To keep one component of a vector parameter fixed, set the corresponding steps
element to 1.</p>

<p>An example usage of <code>DensityMapper</code> which produces the variation in a
coalescent tree density as a function of the population size is provided as
<code>DensityMapper.xml</code> which can be found in the examples directory.</p>

<h2>TreeFromNewickFile</h2>

<p>This class allows trees to be loaded at runtime from Newick files rather
than stored in the BEAST 2 XML:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;tree</span> <span class="na">spec=</span><span class="s">'feast.fileio.TreeFromNewickFile'</span> <span class="na">fileName=</span><span class="s">"example.tree"</span>
    <span class="na">IsLabelledNewick=</span><span class="s">"true"</span> <span class="na">adjustTipHeights=</span><span class="s">"false"</span> <span class="err">...</span><span class="nt">/&gt;</span>
</code></pre></div>
<p>This is a short extension to <code>TreeParser</code>, so all of the various inputs
supported by that class are also supported by <code>TreeFromNewickFile</code>.</p>

<h2>AlignmentFromNexus/Fasta</h2>

<p>This class allows alignments to be loaded at runtime from Nexus or Fasta files
rather than stored in the BEAST 2 XML:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- Nexus: --&gt;</span>
<span class="nt">&lt;alignment</span> <span class="na">spec=</span><span class="s">'feast.fileio.AlignmentFromNexus'</span> <span class="na">fileName=</span><span class="s">"example.nexus"</span><span class="nt">/&gt;</span>

<span class="c">&lt;!-- Fasta: --&gt;</span>
<span class="nt">&lt;alignment</span> <span class="na">spec=</span><span class="s">'feast.fileio.AlignmentFromFasta'</span> <span class="na">fileName=</span><span class="s">"example.fasta"</span><span class="nt">/&gt;</span>
</code></pre></div>
<p>The Fasta import uses the sequence labels from the file as taxon labels.</p>

<p>Obviously these classes runs contrary to BEAST&#39;s philosophy of keeping
everything necessary to run an analysis in the XML file.  However, it
is sometimes convenient to be able to do this.  As a bonus, the
<code>xmlFileName</code> attribute can be used to write the appropriate XML
fragment to disk.</p>

<h2>NexusWriter</h2>

<p>This class complements <code>NexusParser</code>, allowing both trees and alignments to be
written to <a href="http://dx.doi.org/10.1093%2Fsysbio%2F46.4.590">Nexus files</a>.
It contains a single static method
<code>java
public static void write(Alignment alignment, List&lt;Tree&gt; trees, PrintStream ps)
</code>
that writes the Nexus-formatted data to the given <code>PrintStream</code>.</p>

<p>This could be easily used as the basis for a utility which extracts alignments
from BEAST 2 input files.</p>

<h2>Expression Calculator</h2>

<p>The following classes, which are found in <code>feast.expressions</code>, provide
support for parsing of simple arithmetic expressions.</p>

<h3>ExpCalculator</h3>

<p>Takes an arithmetic expression and returns the result by acting
as a Loggable or a Function.  Binary operators can be applied to
Functions (including Parameters) of different lengths as in R, with
the result having the maximum of the two lengths, and the index into
the shortest parameter being the result index modulo the length of
that parameter.</p>

<p>Example expressions (I and J are IDs of RealParameters with elements
{1.0, 2.0, 3.0} and {5.0, 10.0}, respectively.)</p>
<div class="highlight"><pre><code class="language-" data-lang="">Expression                 |  Loggable/Function value
------------------------------------------------------
2.5*I                      | {2.5, 5.0, 7.5}
I+J                        | {6.0, 12.0, 8.0}
exp(I[0])                  | {2.718...}
-log(exp(J))/(1.5+0.5*I[0])| {-2.5, -5.0}
sqrt(J)                    | {2.236..., 3.162...}
2^I                        | {2.0, 4.0, 6.0}  
sum(I)                     | {6.0}
{1,2,3}^2                  | {1.0, 4.0, 9.0}
{I,J}                      | {1.0, 2.0, 3.0, 5.0, 10.0}
theta(I-2)                 | {0.0, 1.0, 1.0}
</code></pre></div>
<p>Note that since each ExpCalculator is a Function object itself, it can
be used as the input for other ExpCalculators.</p>

<p>Inspired by RPNcalculator by Joseph Heled (BEAST 1, BEAST 2 port by
Denise Kuehnert).  (This uses a parser generated by
<a href="http://www.antlr.org">ANTLR</a>, which is cheating.)</p>

<h3>ExpCalculatorDistribution</h3>

<p>This is basically identical to ExpCalculator, but extends the abstract
Distribution class, allowing the definition of arbitrary distributions
over R<sup>n</sup> at runtime.  Distributions can be specified in terms of their
log or directly as probabilities (/probability densities).</p>

<p>The file <code>ECdistribTest.xml</code> in the examples/ folder is a simple
example where a multi-variate normal distribution is constructed.
This example also illustrates the nested expression concept mentioned
above.  The file <code>ECdistribArraytest.xml</code> in the same folder samples
the same posterior, but uses array notation to express the target
density.</p>

<h3>ExpCalculatorParametricDistribution</h3>

<p>This provides a cut-down version of the ExpCalculatorDistribution
functionality that is compatible with beast.math.distributions.Prior.</p>

<h2>License</h2>

<p>This software is free (as in freedom).  With the exception of the
libraries on which it depends, it is made available under the terms of
the GNU General Public Licence version 3, which is contained in this
directory in the file named COPYING.</p>

		</div>
	</div>			
	<div class="col-md-1"></div>
</div>


	
	</div>
	
	<div id="footer"><span style="display:none">foo</span></div>
		
</body>
</html>

